#!/usr/bin/env ruby

# Sublime Text 2 Settings
# sublime: x_syntax Packages/Ruby/Ruby.tmLanguage
# sublime: translate_tabs_to_spaces true
# sublime: tab_size  2

require 'githooks'
require 'optparse'
require 'ostruct'

STANDARD_GIT_HOOKS = %w(
  pre-commit
  prepare-commit-msg
  commit-msg
  post-commit

  applypatch-msg
  pre-applypatch
  post-applypatch

  pre-rebase
  post-merge

  update
  post-update
)


# if we're symlinked to a git hook filename, then run the hook
# scripts for that particular hook and exit.
if STANDARD_GIT_HOOKS.include?(hook = Pathname.new($0).basename)
  #  1. reopen stdout -> stderr (git looks for messages from stderr)
  #  2. instantiate the relevant hook Object
  #  3. load .git/hooks/<hookname>/<hookname>_init.rb
  #  4. load .git/hooks/<hookname>/tests/*.rb
  #  5. run tests
  $stdout.reopen($stderr)
  GitHooks::Hook.new(hook).run(ARGV.dup)
end

$options = OpenStruct.new({
  :hooks => STANDARD_GIT_HOOKS,
  :force => false
})
